# Предсказание патагенности бактерии по данным NGS-секвенирования

**NB. Данный документ может редактироваться и дополняться в течение выполнения проекта**

## Техничекие детали

Вам в распоряжение предоставлен удаленный сервер bioinf0X.bioinf.me, где X -- номер, который соотвестует вашей команде. Вы можете подключиться к нему используя ssh, где user0Y и bioinf0X -- ваш пользователь и ваша команда соотвественно:
```
ssh user0Y@bioinf0X.bioinf.me
```

На данном кластере доступны вам доступные некоторые ресурсы: 16GB оперативной памяти, 100ГБ дискового пространства, быстрый интернет и 4 процессора.

Для вашей команды также создана общая папка `/data/`, **внутри которой** на данный момент лежат папка `small_dataset`, которая содержит fastq-данные секвенирования бактерий:

```{bash }
ls small_dataset | head -2
```


```{bash }
ls small_dataset/PRJDA40637
```

Также доступен файл `info.tsv`, содержащий информацию об этих файлах и их соответствие патогенным и непатогенным бактериям.

```{bash }
head info.tsv
```

Также вам будет доступна web-версия Rstudio на этом сервере, доступ к ней можно получить в браузере https://bioinf0X.bioinf.me/rstudio, логин и пароль для авторизации совпадают и именем пользователя и паролем для ssh.

## Библиотеки

Для вашего удобства на кластере уже установлены NCBI Eutils https://www.ncbi.nlm.nih.gov/books/NBK25500/ (она понадобиться вам, чтобы скачивать бактериальные геномы):

```
$ efetch --help | head
efetch 6.10

Format Selection

  -format        Format of record or report
  -mode          text, xml, asn.1, json

Direct Record Selection

  -db            Database name

```

И seqan_mason (она понадобится вам, чтобы генерировать риды по бактериальному геному).

```
$ seqan_mason
Mason - A Read Simulator
(c) 2010 by Manuel Holtgrewe

Usage: mason illumina [OPTIONS] [SEQUENCE.fasta]
       mason 454 [OPTIONS] [SEQUENCE.fasta]
       mason sanger [OPTIONS] [SEQUENCE.fasta]

Call with 'mason READS-TYPE --help' to get detailed help.

```

## Ожидамая работа над проектом

Мы хотим обучить классификатор патогенности/непатогенности бактерии по данным NGS-секвенирования, входными данными являются данные paired-end секвенирования -- два файла парных ридов.

Папка small_dataset содержит пример таких данных, на которых вы можете начать обучать классификатор, пока другая часть команды занимается получением данных из базы данных IMG https://img.jgi.doe.gov/cgi-bin/m/main.cgi. Эта база данных содержит аннотацию о геномах различных микробов. Обращаю ваше внимание, что в нашей работе нас будут прежде всего интересовать **бактериальные геномы**, потенциальным хостом которых может являться **человек**.

После того, как вы получить из IMG ссылки на геномы, которые вам нужны, вы сможете их скачать, используя NCBI eutils.

После того, как вы скачаете fasta файлы с геномами, вы должны нагенерировать риды секвенирования секвенатора Illumina. Для этого вы должны воспользоваться программой seqan_mason, и эти данные затем будут подаваться на вход обучения вашего классификатора.

## Классификатор

Ожидается, что классификатор должен говорить, является бактерия патогенной или нет, однако имеет смысл разбить данную задачу на две. Для начала стоит написать классификатор отдельных ридов. Мы подаем рид на вход, и говорим откуда это рид пришёл -- из патогенной бактерии, или не патогенной бактерии. А затем можно написать классификатор, который бы агреггировал суммарную информацию классифицированных ридов.

Риды -- не очень удобный инструмент классификации, поэтому следует определить некоторые признаки у ридов: мы будем смотреть только на признаки связанные с последовательностями нуклеотидов: вхождения определенных K-mer и Spaced words.

**Описание этих признаков появятся чуть ниже. **

### Встречаемость k-mer

Пускай у нас есть рид "ATATGCTATCCG".

K-mer -- любая возможная подстрока длины k внутри рида. Стоит прочитать статью https://en.wikipedia.org/wiki/K-mer.

Тогд для нашего рида несложно посчитать встречаемость подстрок:
```{r echo=F}
find_kmers <- function(string, k){
  n <- nchar(string) - k + 1
  kmers <- substring(string, 1:n, 1:n + k - 1)
  return(kmers)
}

st <- "ATATGCTATCCG"
table(find_kmers(st, 1))
table(find_kmers(st, 2))
table(find_kmers(st, 3))
```

Вместо самой встречаемости может иметь смысл посчитать "долю" к-меров.
```{r }
st <- "ATATGCTATCCG"
table(find_kmers(st, 1)) / length(find_kmers(st, 1))
table(find_kmers(st, 2)) / length(find_kmers(st, 2))
table(find_kmers(st, 3)) / length(find_kmers(st, 3))
```

Но конечно, же, не стоит забывать про k-меры, которые не встретились.

NB. Важно помнить, что вместе с k-мером стоит также считать комплиментарный k-mer. Так как ДНК у нас двуцепочечная, вы прекрасно знаете, что если у вас встретился k-mer "GAAA", то на противоположной цепи обязательно есть k-mer "TTTC". Поэтому эти k-mer всегда нужно считать вместе.

### Spaced words counts

**From the original paper**

**Spaced words** were introduced for the alignment of dissimilar sequences. Thus, their incorporation
is useful in the context of novel species discovery. Spaced words denote the occurrence of all $k$-mers interrupted
by $(l-k)$ spacers in a word of length $l$. 

Рассмотрим строку "ATATGCTATCCG" давайте посчитаем spaced words для k = 4, l = 6. Spaced word для kmera $ATAT$ может выглядеть несколькими образами: "ANNTAT", "ATNNAT", "ATANNT", где NN -- вставка из двух нуклеотидов, которая имеет любой вид. Именно такие вхождения строки ATAT в подстроки длины 6 и нужно посчитать.

Вы можете выбрать несколько k и l, и посчитать такие признаки.


## Оценка проекта

Я буду отслеживать вашу работу в течение хакатона, и буду следить за тем, какие команды сильнее продвинутся по проекту. Если окажется, что будут команды, которые успеют закончить проект целиком -- я буду оценивать их классификаторы, на своём датасете основанном на IMG, используя 10 fold cross validation, буду смотреть на accuracy и ROC curve, если ваши классификаторы смогут их построить.

